--- proftpd-1.3.9/contrib/mod_clamav.c~	2025-10-19 00:25:33.000000000 +0200
+++ proftpd-1.3.9/contrib/mod_clamav.c	2025-10-19 00:28:59.346661444 +0200
@@ -239,7 +239,7 @@
   buf = malloc(bufsz);
   if (!buf) {
     pr_log_pri(PR_LOG_CRIT, "Out of memory!");
-    end_login(1);
+    pr_session_end(1);
   }
 
   /* send file contents using protocol defined by Clamd */
@@ -659,18 +659,18 @@
  * Configuration setter: ClamAV
  */
 MODRET set_clamav(cmd_rec *cmd) {
-  int bool = -1;
+  int boolean = -1;
   config_rec *c = NULL;
 
   CHECK_ARGS(cmd, 1);
   CHECK_CONF(cmd, CONF_ROOT|CONF_LIMIT|CONF_VIRTUAL|CONF_GLOBAL|CONF_DIR);
 
-  if ((bool = get_boolean(cmd,1)) == -1)
+  if ((boolean = get_boolean(cmd,1)) == -1)
     CONF_ERROR(cmd, "expected Boolean parameter");
 
   c = add_config_param(cmd->argv[0], 1, NULL);
   c->argv[0] = pcalloc(c->pool, sizeof(unsigned char));
-  *((unsigned char *) c->argv[0]) = bool;
+  *((unsigned char *) c->argv[0]) = boolean;
   c->flags |= CF_MERGEDOWN;
 
   return PR_HANDLED(cmd);
@@ -680,18 +680,18 @@
  * Configuration setter: ClamStream
  */
 MODRET set_clamstream(cmd_rec *cmd) {
-  int bool = -1;
+  int boolean = -1;
   config_rec *c = NULL;
 
   CHECK_ARGS(cmd, 1);
   CHECK_CONF(cmd, CONF_ROOT|CONF_LIMIT|CONF_VIRTUAL|CONF_GLOBAL|CONF_DIR);
 
-  if ((bool = get_boolean(cmd,1)) == -1)
+  if ((boolean = get_boolean(cmd,1)) == -1)
     CONF_ERROR(cmd, "expected Boolean parameter");
 
   c = add_config_param(cmd->argv[0], 1, NULL);
   c->argv[0] = pcalloc(c->pool, sizeof(unsigned char));
-  *((unsigned char *) c->argv[0]) = bool;
+  *((unsigned char *) c->argv[0]) = boolean;
   c->flags |= CF_MERGEDOWN;
 
   return PR_HANDLED(cmd);
@@ -701,18 +701,18 @@
  * Configuration setter: ClamFailsafe
  */
 MODRET set_clamfailsafe(cmd_rec *cmd) {
-  int bool = -1;
+  int boolean = -1;
   config_rec *c = NULL;
 
   CHECK_ARGS(cmd, 1);
   CHECK_CONF(cmd, CONF_ROOT|CONF_LIMIT|CONF_VIRTUAL|CONF_GLOBAL|CONF_DIR);
 
-  if ((bool = get_boolean(cmd, 1)) == -1)
+  if ((boolean = get_boolean(cmd, 1)) == -1)
     CONF_ERROR(cmd, "expected Boolean parameter");
 
   c = add_config_param(cmd->argv[0], 1, NULL);
   c->argv[0] = pcalloc(c->pool, sizeof(unsigned char));
-  *((unsigned char *) c->argv[0]) = bool;
+  *((unsigned char *) c->argv[0]) = boolean;
   c->flags |= CF_MERGEDOWN;
 
   return PR_HANDLED(cmd);
